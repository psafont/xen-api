(rule
 (with-stdout-to
  xcp-networkd.1
  (run %{dep:networkd.exe} --help=groff)
 )
)

(rule
 (target xcp-networkd.1.gz)
 (deps (:man xcp-networkd.1))
 (action
  (with-stdout-to %{target} (with-stdin-from %{man} (run gzip))))
)

(executable
 (name networkd)
 (modes exe)
 (libraries
  astring

  forkexec
  http_lib
  integers
  netlink
  networklibs
  rpclib.core
  rpclib.json
  result
  rresult
  threads.posix
  xapi-client
  xapi-consts
  xapi-consts.xapi_version
  xapi-stdext-pervasives
  xapi-stdext-std
  xapi-stdext-threads
  xapi-stdext-unix
  xapi-inventory
  xapi-idl
  xapi-idl.network
  xapi-log
  xapi-types
  xen-api-client))

(alias
 (name man)
 (deps xcp-networkd.1.gz)
)

(install
 (package xapi-tools)
 (section man)
 (files xcp-networkd.1.gz)
)

(install
 (package xapi-tools)
 (section sbin)
 (files (networkd.exe as xcp-networkd))
)
